<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-styles/paper-styles-classes.html">
<link rel="import" href="../../bower_components/paper-styles/paper-styles.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../../bower_components/paper-date-picker-item/paper-date-picker-item.html">
<link rel="import" href="../../bower_components/paper-chips-input/paper-chips-input.html">

<dom-module id="graph-settings"">
<template>
  <style>
    :host {
      display: block;
    }

    .applybtn {
      color: var(--accent-color);
    }

    .section {
      color: var(--primary-color);
      text-align: left;
    }

    paper-chips-input {
      width: 100%;
    }
  </style>
  <div class="layout vertical">

    <div class="section paper-font-code2 self-end">
      Settings
      <iron-icon icon="settings"></iron-icon>
    </div>


    <div class="section paper-font-body2">Graph</div>


    <div class="layout vertical">

      <paper-input type="date" label="From Date" value="{{dataFilter.rangeFrom}}"></paper-input>

      <paper-input type="date" label="To Date" value="{{dataFilter.rangeTo}}"></paper-input>

      <paper-dropdown-menu label="X-Axis">
        <paper-listbox class="dropdown-content" selected="{{dataFilter.axis.x}}" attr-for-selected="enum-value">
          <paper-item enum-value="TIME">Time</paper-item>
          <!-- TODO Additional setting for day of week, week in month etc -->
          <paper-item enum-value="DESTINATION">Destination</paper-item>
          <paper-item enum-value="AIRLINE">Airline</paper-item>
        </paper-listbox>
      </paper-dropdown-menu>

      <paper-dropdown-menu label="Y-Axis">
        <paper-listbox class="dropdown-content" selected="{{dataFilter.axis.y}}" attr-for-selected="enum-value">
          <paper-item enum-value="FLIGHTS">Flights</paper-item>
          <paper-item enum-value="PASSENGERS">Passengers</paper-item>
          <paper-item enum-value="DELAYFREQ">Delays</paper-item>
          <paper-item enum-value="AVGDELAY">Delay Duration</paper-item>
          <paper-item enum-value="CANCELLATIONS">Cancellations</paper-item>
        </paper-listbox>
      </paper-dropdown-menu>
    </div>

    <div class="section paper-font-body2">Selectors and Filters</div>

    <div class="section paper-font-body1">Time Selector</div>
    <paper-dropdown-menu label="Time Selector">
      <paper-listbox class="dropdown-content" selected="{{dataFilter.filter.timestep}}" attr-for-selected="enum-value">
        <paper-item enum-value="DAY_OF_WEEK">Day of week</paper-item>
        <paper-item enum-value="MONTH">Month</paper-item>
        <paper-item enum-value="YEAR">Year</paper-item>
      </paper-listbox>
    </paper-dropdown-menu>

    <div class="section paper-font-body1">Airline Selector</div>
    <paper-chips-input label="Add an Airline" values="[[_computeAirlines(airlines)]]"
                       selected-values="{{dataFilter.filter.airlines}}"></paper-chips-input>

    <div class="section paper-font-body1">Destination Selector</div>
    <paper-chips-input label="Add a Market" values="[[_computeMarkets(markets)]]"
                       selected-values="{{dataFilter.filter.destinations}}"></paper-chips-input>
  </div>


  <paper-button class="applybtn" on-tap="_applySetting">Apply</paper-button>

  <paper-checkbox
    checked="{{dataFilter.shareable}}">Public
  </paper-checkbox>

  <paper-input
    id="settingsNameInput"
    label="Settings Name"
    value="{{dataFilter.name}}"
    required
    auto-validate
    minlength="3"></paper-input>

  <paper-button raised disabled="[[!dataFilter.name]]" on-tap="_saveSettings">Save</paper-button>

  </div>
</template>
<script>
  (function () {
    'use strict';

    Polymer({
      is: 'graph-settings',

      properties: {

        airlines: {
          type: Array,
          notify: true
        },

        markets: {
          type: Array,
          notify: true
        },

        dataFilter: {
          type: Object,
          value: {
            name: "",
            shareable: false,
            rangeFrom: null,
            rangeTo: null,
            axis: {
              x: 0,
              y: 0
            },
            filter: {
              timestep: "",
              airlines: [],
              destinations: []
            }
          }
        }
      },

      _applySetting: function (event) {
        this.fire("apply-setting", this.dataFilter);
      },

      _saveSettings: function () {
        if (this.$.settingsNameInput.invalid) {
          return;
        }
        console.log(this.dataFilter);
        this.fire("save-setting", this.dataFilter);
      },

      _computeAirlines: function (airlines) {
        return airlines.map(function (a) {
          a.label = a.name;
          return a;
        });
      },

      _computeMarkets: function (markets) {
        return markets.map(function (m) {
          m.label = m.name;
          return m;
        });
      }
    })
    ;
  })();
</script>
</dom-module>
